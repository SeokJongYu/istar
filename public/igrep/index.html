<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Jacky Lee">
    <meta name="description" content="istar, SaaS, web, idock, docking, node.js, rest, email">
    <title>istar: A SaaS Platform for idock</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/ui-lightness/jquery-ui-1.8.20.custom.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

    <link rel="shortcut icon" href="favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-57-precomposed.png">

    <!-- Grab CDNJS's Modernizr, with a protocol relative URL; fall back to local if offline -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.5.3/modernizr.min.js"></script>
    <script>window.Modernizr || document.write('<script src="js/modernizr-2.5.3.min.js"><\/script>')</script>
  </head>

  <body>

    <!-- Fork me on GitHub banner -->
    <a id="ribbon" href="https://github.com/HongjianLi/istar"></a>

    <div class="container">

      <!-- Header -->
      <header class="hero-unit">
        <h1><img src="img/logo.svg" class="logo" alt="logo" />istar</h1>
        <p>A SaaS platform for idock</p>
      </header>

      <!-- Existing jobs -->
      <section>
        <div class="page-header">
          <h1>Jobs</h1>
        </div>
        <div class="row">
          <div class="span12">
            <div id="jobs"></div>
            <div class="progress progress-success progress-striped active">
              <div class="bar" style="width: 40%"></div>
            </div>
            <div class="pagination pagination-centered">
              <ul>
                <li class="disabled"><a href="#">&laquo;</a></li>
                <li class="active "><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">&raquo;</a></li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Submit a new job -->
      <section>
        <div class="page-header">
          <h1>New job</h1>
        </div>
        <div class="row">
          <div class="span6">
            <div class="control-group">
              <label class="control-label" for="receptor"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#receptor" rel="tooltip" title="compulsory" id="receptor_label">Receptor in PDBQT</a></label>
              <div class="controls">
                <textarea class="span6" id="receptor" rows="20" placeholder="ATOM      1  N   ASN A  21      63.845  98.298   0.035  1.00113.44    -0.066 N"></textarea>
              </div>
            </div>
          </div>
          <div class="span6">
            <div class="row">
              <div class="span1">
                <div class="control-group">
                  <label class="control-label" for="center_x"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#center_x" rel="tooltip" title="a decimal" id="center_x_label">center_x</a></label>
                  <div class="controls">
                    <input type="text" class="span1" id="center_x" placeholder="1.234">
                  </div>
                </div>
              </div>
              <div class="span1">
                <div class="control-group">
                  <label class="control-label" for="center_y"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#center_y" rel="tooltip" title="a decimal" id="center_y_label">center_y</a></label>
                  <div class="controls">
                    <input type="text" class="span1" id="center_y" placeholder="5.678">
                  </div>
                </div>
              </div>
              <div class="span1">
                <div class="control-group">
                  <label class="control-label" for="center_z"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#center_z" rel="tooltip" title="a decimal" id="center_z_label">center_z</a></label>
                  <div class="controls">
                    <input type="text" class="span1" id="center_z" placeholder="9.012">
                  </div>
                </div>
              </div>
              <div class="span1">
                <div class="control-group">
                  <label class="control-label" for="size_x"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#size_x" rel="tooltip" title="within [1, 30]" id="size_x_label">size_x</a></label>
                  <div class="controls">
                    <input type="text" class="span1" id="size_x" placeholder="20">
                  </div>
                </div>
              </div>
              <div class="span1">
                <div class="control-group">
                  <label class="control-label" for="size_y"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#size_y" rel="tooltip" title="within [1, 30]" id="size_y_label">size_y</a></label>
                  <div class="controls">
                    <input type="text" class="span1" id="size_y" placeholder="18">
                  </div>
                </div>
              </div>
              <div class="span1">
                <div class="control-group">
                  <label class="control-label" for="size_z"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#size_z" rel="tooltip" title="within [1, 30]" id="size_z_label">size_z</a></label>
                  <div class="controls">
                    <input type="text" class="span1" id="size_z" placeholder="22">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span3">
                <div class="control-group">
                  <label class="control-label" for="name"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#description" rel="tooltip" title="compulsory" id="description_label">Briefly describe your job</a></label>
                  <div class="controls">
                    <div class="input-prepend">
                      <span class="add-on"><i class="icon-book"></i></span><input type="text" id="description" placeholder="Screen drug-like ligands for HIV RT">
                    </div>
                  </div>
                </div>
              </div>
              <div class="span3">
                <div class="control-group">
                  <label class="control-label" for="email"><span class="add-on"><i class="icon-asterisk"></i></span> <a href="#email" rel="tooltip" title="compulsory" id="email_label">Your email for receiving result</a></label>
                  <div class="controls">
                    <div class="input-prepend">
                      <span class="add-on"><i class="icon-envelope"></i></span><input type="text" id="email" placeholder="Jacky@cuhk.edu.hk">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <p>Number of ligands satisfying your filtering conditions: <span id="ligands">188820</span></p>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="mwt">Molecular weight (g/mol): [<span id="mwt_lb">400</span>, <span id="mwt_ub">500</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="mwt"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="logp">Partition coefficient xlogP: [<span id="logp_lb">0</span>, <span id="logp_ub">5</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="logp"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="nrb">Rotatable bonds: [<span id="nrb_lb">2</span>, <span id="nrb_ub">8</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="nrb"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="hbd">Hydrogen bond donors: [<span id="hbd_lb">2</span>, <span id="hbd_ub">5</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="hbd"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="hba">Hydrogen bond acceptors: [<span id="hba_lb">2</span>, <span id="hba_ub">10</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="hba"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="charge">Net charge: [<span id="charge_lb">0</span>, <span id="charge_ub">0</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="charge"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="ad">Apolar desolvation (kcal/mol): [<span id="ad_lb">0</span>, <span id="ad_ub">12</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="ad"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="pd">Polar desolvation (kcal/mol): [<span id="pd_lb">-50</span>, <span id="pd_ub">0</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="pd"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <div class="control-group">
                  <label class="control-label" for="tpsa">Polar surface area tPSA (&#8491;&#178;): [<span id="tpsa_lb">20</span>, <span id="tpsa_ub">100</span>]</label>
                  <div class="controls">
                    <div class="input-prepend">
                      <div class="slider" id="tpsa"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="span6">
                <button class="btn btn-primary" id="submit">Submit</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer>
        <p>Copyright &copy; 2012 Chinese University of Hong Kong. Platform designed by <a href="http://appsrv.cse.cuhk.edu.hk/~hjli">Jacky Lee</a>. Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License v2.0</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>.</p>
      </footer>

    </div>

    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.7.2.min.js"><\/script>')</script>

    <script src="js/jquery-ui-1.8.20.custom.min.js"></script>
    <script src="js/bootstrap-tooltip.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/index.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src='//www.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>
﻿<%@ Page Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage" %>

<asp:Content ID="Content1" ContentPlaceHolderID="HeadTopContent" runat="server">
    <meta name="description" content="Home page of CUDAagrep web version." />
    <meta name="keywords" content="CUDAagrep, CUDA, agrep, large scale, approximate, nucleotide, sequence matching, genomes, NCBI, query, pattern, edit distance, ending position, Opossum, Chimpanzee, Human, Monkey, Rat, Mouse, Cow, Dog, Horse, Zebrafish, Chicken, Finch, Pig, Platypus, Grape, Bee, Beetle" />
</asp:Content>

<asp:Content ID="Content2" ContentPlaceHolderID="TitleContent" runat="server">
Home Page
</asp:Content>

<asp:Content ID="Content3" ContentPlaceHolderID="HeadBottomContent" runat="server">
<script type='text/javascript'>
    $(function () {
        $("#Error").dialog({
            autoOpen: false,
            modal: true,
            resizable: false,
            width: 600,
            show: "bounce",
            buttons: {
                "OK": function () {
                    $(this).dialog("close");
                }
            }
        });
        $("#QueryText").resizable();
        $("#SearchButton").button({
            icons: {
                primary: "ui-icon-search"
            }
        }).click(function () {
            $(this).attr("disabled", "true");   // Prevent multiple submission.
            var genomeName = $("#GenomeSelector").val(),
                queryText = $("#QueryText").val().toUpperCase(),
                now = new Date();
            $.post("/Search", { genomeName: genomeName, queryText: queryText }, function (searchResult) {
                if (!searchResult) {  // ModelState.IsValid == false
                    $("#JobStatus").text("error");
                    $("#Error").dialog("open");
                    $("#SearchButton").removeAttr("disabled");  // Enable for a new submission.
                    return;
                }
                $("#JobStatus").text("done");
                var guid = searchResult.Guid,
                    grid = $("#QuerySummaryJQGrid", result),
                    result = $("#Result");
                if (result.attr("style")) {
                    result.slideDown("slow");
                    grid.jqGrid({
                        datatype: 'jsonstring',
                        datastr: searchResult.jqGridTable,
                        colNames: ["Query", "Pattern", "Edit Distance", "Number of Matches", "Querying Time (ms)"],
                        colModel: [
                    { "width": 60, "align": "right", "sortable": false, "resizable": false },
                    { "width": 300, "align": "left", "sortable": false, "resizable": true },
                    { "width": 120, "align": "right", "sortable": false, "resizable": false },
                    { "width": 160, "align": "right", "sortable": false, "resizable": false },
                    { "width": 160, "align": "right", "sortable": false, "resizable": false }
                ],
                        rowNum: 100,
                        height: 200,
                        loadComplete: function () {
                            $("#SearchButton").removeAttr("disabled");  // Enable for a new submission.
                        }
                    });
                } else {
                    grid.setGridParam({
                        datatype: 'jsonstring',
                        datastr: searchResult.jqGridTable
                    });
                    grid.trigger("reloadGrid");
                }
                $("#logFileLink", result).attr("href", "/Genomes/" + genomeName + "/Log_" + guid + ".csv");
                $("#resultFileLink", result).attr("href", "/Genomes/" + genomeName + "/Result_" + guid + ".csv");
                // Update cookie
                var cookieName = "CUDAagrep.Mvc",
                    cookieNameLength = cookieName.length,
                    cookieValue;
                if (document.cookie) {
                    var cookies = document.cookie.split('; ');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i];
                        if (cookie.substring(0, cookieNameLength + 1) == (cookieName + '=')) {
                            cookieValue = cookie.substring(cookieNameLength + 1);
                            break;
                        }
                    }
                }
                var record = genomeName + "," + guid + "," + now.getTime();
                if (cookieValue) {
                    document.cookie = cookieName + "=" + record + "&" + cookieValue;
                }
                else {
                    var expireDate = new Date();
                    expireDate.setTime(expireDate.getTime() + (7 * 24 * 60 * 60 * 1000));
                    document.cookie = cookieName + "=" + record + ";expires=" + expireDate.toUTCString();
                }
            }, "json");
            $("#Status").slideDown("slow");
            $("#JobStatus").html('&nbsp; <img src="/Content/images/Searching.gif" height="16"/>');
            $("#JobGenomeName").fadeOut("normal").text(genomeName).attr("href", "/Genome/" + genomeName).fadeIn("slow");
            $("#JobDate").fadeOut("normal").text(now.toLocaleString()).fadeIn("slow");
            return false;   // Prevent default postback.
        });
    });
</script>
</asp:Content>

<asp:Content ID="Content4" ContentPlaceHolderID="MainContent" runat="server">
<p>
This website serves as an online version of CUDAagrep, which is a fast CUDA implementation of the k-difference agrep algorithm for large scale approximate nucleotide sequence matching.
A total of <%: Html.ActionLink("17 assembled genomes of different species", "Genome") %> have been collected from <a href="ftp://ftp.ncbi.nih.gov/genomes/">NCBI's official ftp site</a> and pre-loaded. Their genome sizes vary from 0.19 Gbp to 3.50 Gbp.
A query consists of a pattern of alphabet A, C, G, T, N and an edit distance. N is a wildcard and must match either A, C, G, or T in the genome. Substitution, insertion and deletion have a uniform cost of one edit distance. The pattern length must be between 1 and 64, and the edit distance must be between 0 and 9. For each query, a maximum of 10,000 ending positions of matches will be returned.
</p>
<b>Select a genome to search.</b><br />
<div class="control">
    <select id="GenomeSelector">
    <option>Monodelphis domestica (Gray short-tailed opossum)</option>
    <option>Pan troglodytes (Chimpanzee)</option>
    <option selected="selected">Homo sapiens (Human)</option>
    <option>Macaca mulatta (Rhesus monkey)</option>
    <option>Rattus norvegicus (Rat)</option>
    <option>Mus musculus (Mouse)</option>
    <option>Bos taurus (Cow)</option>
    <option>Canis familiaris (Dog)</option>
    <option>Equus caballus (Domestic horse)</option>
    <option>Danio rerio (Zebrafish)</option>
    <option>Gallus gallus (Chicken)</option>
    <option>Taeniopygia guttata (Zebra finch)</option>
    <option>Sus scrofa (Pig)</option>
    <option>Ornithorhynchus anatinus (Platypus)</option>
    <option>Vitis vinifera (Grape)</option>
    <option>Apis mellifera (Honey bee)</option>
    <option>Tribolium castaneum (Red flour beetle)</option>
    </select>
</div>
<b>Define queries, each of which is made up of a pattern to search for followed by an edit distance.</b><br />
<div class="control">
    <textarea id="QueryText" cols="2" rows="2" style="width: 530px; margin: 0">CTGCATGGTGGGGAAAAGGCATAGCCTGGG3
AAAAGTGTTATGGGTTGTTTAATCAACCACTGAACTGCGGGGGTGACTAGTTATAACTTA6</textarea>
</div>
<button id="SearchButton">Search</button>
<div id="Error" title="User Input Error">
	<div class="ui-state-error ui-corner-all" style="padding: 0px .7em; margin-top: 10px;"> 
		<p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 
			The query text does not conform to the standard format. Please make sure:<br />
            1) Each line represents one query, which consists of a pattern of alphabet A, C, G, T, N and an edit distance from 0 to 9.<br />
            2) For each query, the edit distance must not exceed the pattern length.<br />
            3) For each job, up to 100 queries will be processed.
        </p>
	</div>
</div>
<div id="Status" style="padding: 10px 0 10px 0; display: none">Searching <a id="JobGenomeName"></a> genome on <span id="JobDate"></span> ... <span id="JobStatus"></span></div>
<div id="Result" style="display: none">
<table id="QuerySummaryJQGrid"></table><br />
<img src="/Content/images/Excel.png" width="16" height="16" alt="" title="Open CSV by Excel" />&nbsp; <a id="logFileLink">Log.csv</a> - query summary. &nbsp; &nbsp; &nbsp; <img src="/Content/images/Excel.png" width="16" height="16" alt="" title="Open CSV by Excel" />&nbsp; <a id="resultFileLink">Result.csv</a> - matching positions.
</div>
</asp:Content>
