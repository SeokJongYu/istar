<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Jacky Lee">
    <meta name="description" content="igrep, approximate nucleotide sequence matching, CUDA, agrep">
    <title>igrep: a fast CUDA implementation of agrep algorithm for approximate nucleotide sequence matching</title>

    <link href="/bootstrap.min.css" rel="stylesheet">
    <link href="/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/ui-lightness/jquery-ui-1.8.20.custom.css" rel="stylesheet">
    <link href="/index.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-57-precomposed.png">

    <!-- Grab CDNJS's Modernizr, with a protocol relative URL; fall back to local if offline -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.5.3/modernizr.min.js"></script>
    <script>window.Modernizr || document.write('<script src="/modernizr-2.5.3.min.js"><\/script>')</script>
  </head>

  <body>

    <div class="container">

      <!-- Header -->
      <header class="hero-unit">
        <h1><img id="logo" src="logo.svg" alt="logo" />igrep</h1>
        <p>a fast CUDA implementation of agrep algorithm for approximate nucleotide sequence matching</p>
      </header>

      <!-- Existing jobs -->
      <section>
        <div class="page-header">
          <h1>Jobs</h1>
        </div>
        <div class="row">
          <div class="span12">
            <div id="jobs"></div>
            <div class="progress progress-success progress-striped active">
              <div class="bar" style="width: 40%"></div>
            </div>
            <div class="pagination pagination-centered">
              <ul>
                <li class="disabled"><a href="#">&laquo;</a></li>
                <li class="active "><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">&raquo;</a></li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Submit a new job -->
      <section>
        <div class="page-header">
          <h1>New job</h1>
        </div>
        <div class="row">
          <div class="span12">
<p>
This website serves as an online version of CUDAagrep, which is a fast CUDA implementation of the k-difference agrep algorithm for large scale approximate nucleotide sequence matching.
A total of <%: Html.ActionLink("17 assembled genomes of different species", "Genome") %> have been collected from <a href="ftp://ftp.ncbi.nih.gov/genomes/">NCBI's official ftp site</a> and pre-loaded. Their genome sizes vary from 0.19 Gbp to 3.50 Gbp.
A query consists of a pattern of alphabet A, C, G, T, N and an edit distance. N is a wildcard and must match either A, C, G, or T in the genome. Substitution, insertion and deletion have a uniform cost of one edit distance. The pattern length must be between 1 and 64, and the edit distance must be between 0 and 9. For each query, a maximum of 10,000 ending positions of matches will be returned.
</p>
<b>Select a genome to search.</b><br />
<div class="control">
    <select id="GenomeSelector">
    <option>Monodelphis domestica (Gray short-tailed opossum)</option>
    <option>Pan troglodytes (Chimpanzee)</option>
    <option selected="selected">Homo sapiens (Human)</option>
    <option>Macaca mulatta (Rhesus monkey)</option>
    <option>Rattus norvegicus (Rat)</option>
    <option>Mus musculus (Mouse)</option>
    <option>Bos taurus (Cow)</option>
    <option>Canis familiaris (Dog)</option>
    <option>Equus caballus (Domestic horse)</option>
    <option>Danio rerio (Zebrafish)</option>
    <option>Gallus gallus (Chicken)</option>
    <option>Taeniopygia guttata (Zebra finch)</option>
    <option>Sus scrofa (Pig)</option>
    <option>Ornithorhynchus anatinus (Platypus)</option>
    <option>Vitis vinifera (Grape)</option>
    <option>Apis mellifera (Honey bee)</option>
    <option>Tribolium castaneum (Red flour beetle)</option>
    </select>
</div>
<b>Define queries, each of which is made up of a pattern to search for followed by an edit distance.</b><br />
<div class="control">
    <textarea id="QueryText" cols="2" rows="2" style="width: 530px; margin: 0">CTGCATGGTGGGGAAAAGGCATAGCCTGGG3
AAAAGTGTTATGGGTTGTTTAATCAACCACTGAACTGCGGGGGTGACTAGTTATAACTTA6</textarea>
</div>
<button id="SearchButton">Search</button>
<div id="Error" title="User Input Error">
	<div class="ui-state-error ui-corner-all" style="padding: 0px .7em; margin-top: 10px;"> 
		<p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 
			The query text does not conform to the standard format. Please make sure:<br />
            1) Each line represents one query, which consists of a pattern of alphabet A, C, G, T, N and an edit distance from 0 to 9.<br />
            2) For each query, the edit distance must not exceed the pattern length.<br />
            3) For each job, up to 100 queries will be processed.
        </p>
	</div>
</div>
<div id="Status" style="padding: 10px 0 10px 0; display: none">Searching <a id="JobGenomeName"></a> genome on <span id="JobDate"></span> ... <span id="JobStatus"></span></div>
<div id="Result" style="display: none">
<table id="QuerySummaryJQGrid"></table><br />
<img src="/Content/images/Excel.png" width="16" height="16" alt="" title="Open CSV by Excel" />&nbsp; <a id="logFileLink">Log.csv</a> - query summary. &nbsp; &nbsp; &nbsp; <img src="/Content/images/Excel.png" width="16" height="16" alt="" title="Open CSV by Excel" />&nbsp; <a id="resultFileLink">Result.csv</a> - matching positions.
</div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer>
        <p>Copyright &copy; 2012 Chinese University of Hong Kong. Platform designed by <a href="http://www.cse.cuhk.edu.hk/~hjli">Jacky Lee</a>. Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License v2.0</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>.</p>
      </footer>

    </div>

    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/jquery-1.7.2.min.js"><\/script>')</script>

    <script src="/jquery-ui-1.8.20.custom.min.js"></script>
    <script src="/bootstrap-tooltip.js"></script>
    <script src="/jquery.cookie.js"></script>
    <script src="/index.js"></script>

    <!-- Asynchronous Google Analytics snippet -->
    <script>
      var _gaq=[['_setAccount','UA-20604862-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src='//www.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>

<script type='text/javascript'>
    $(function () {
        $("#Error").dialog({
            autoOpen: false,
            modal: true,
            resizable: false,
            width: 600,
            show: "bounce",
            buttons: {
                "OK": function () {
                    $(this).dialog("close");
                }
            }
        });
        $("#QueryText").resizable();
        $("#SearchButton").button({
            icons: {
                primary: "ui-icon-search"
            }
        }).click(function () {
            $(this).attr("disabled", "true");   // Prevent multiple submission.
            var genomeName = $("#GenomeSelector").val(),
                queryText = $("#QueryText").val().toUpperCase(),
                now = new Date();
            $.post("/Search", { genomeName: genomeName, queryText: queryText }, function (searchResult) {
                if (!searchResult) {  // ModelState.IsValid == false
                    $("#JobStatus").text("error");
                    $("#Error").dialog("open");
                    $("#SearchButton").removeAttr("disabled");  // Enable for a new submission.
                    return;
                }
                $("#JobStatus").text("done");
                var guid = searchResult.Guid,
                    grid = $("#QuerySummaryJQGrid", result),
                    result = $("#Result");
                if (result.attr("style")) {
                    result.slideDown("slow");
                    grid.jqGrid({
                        datatype: 'jsonstring',
                        datastr: searchResult.jqGridTable,
                        colNames: ["Query", "Pattern", "Edit Distance", "Number of Matches", "Querying Time (ms)"],
                        colModel: [
                    { "width": 60, "align": "right", "sortable": false, "resizable": false },
                    { "width": 300, "align": "left", "sortable": false, "resizable": true },
                    { "width": 120, "align": "right", "sortable": false, "resizable": false },
                    { "width": 160, "align": "right", "sortable": false, "resizable": false },
                    { "width": 160, "align": "right", "sortable": false, "resizable": false }
                ],
                        rowNum: 100,
                        height: 200,
                        loadComplete: function () {
                            $("#SearchButton").removeAttr("disabled");  // Enable for a new submission.
                        }
                    });
                } else {
                    grid.setGridParam({
                        datatype: 'jsonstring',
                        datastr: searchResult.jqGridTable
                    });
                    grid.trigger("reloadGrid");
                }
                $("#logFileLink", result).attr("href", "/Genomes/" + genomeName + "/Log_" + guid + ".csv");
                $("#resultFileLink", result).attr("href", "/Genomes/" + genomeName + "/Result_" + guid + ".csv");
                // Update cookie
                var cookieName = "CUDAagrep.Mvc",
                    cookieNameLength = cookieName.length,
                    cookieValue;
                if (document.cookie) {
                    var cookies = document.cookie.split('; ');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i];
                        if (cookie.substring(0, cookieNameLength + 1) == (cookieName + '=')) {
                            cookieValue = cookie.substring(cookieNameLength + 1);
                            break;
                        }
                    }
                }
                var record = genomeName + "," + guid + "," + now.getTime();
                if (cookieValue) {
                    document.cookie = cookieName + "=" + record + "&" + cookieValue;
                }
                else {
                    var expireDate = new Date();
                    expireDate.setTime(expireDate.getTime() + (7 * 24 * 60 * 60 * 1000));
                    document.cookie = cookieName + "=" + record + ";expires=" + expireDate.toUTCString();
                }
            }, "json");
            $("#Status").slideDown("slow");
            $("#JobStatus").html('&nbsp; <img src="/Content/images/Searching.gif" height="16"/>');
            $("#JobGenomeName").fadeOut("normal").text(genomeName).attr("href", "/Genome/" + genomeName).fadeIn("slow");
            $("#JobDate").fadeOut("normal").text(now.toLocaleString()).fadeIn("slow");
            return false;   // Prevent default postback.
        });
    });
</script>

